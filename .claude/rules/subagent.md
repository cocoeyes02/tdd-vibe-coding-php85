# サブエージェント運用ルール

## スキルの共有

サブエージェントは `.claude/skills/` のスキルファイルを自動で読み込まない。

バックグラウンドでサブエージェントを起動する場合は、以下の手順を守ること：

1. 関連するスキルファイル（例: `.claude/skills/tdd/SKILL.md`）を `Read` で読む
2. スキルの内容をサブエージェントへのプロンプトに埋め込む
3. 特に `/php-review` 必須ルールなど、PR作成に関わるルールを漏らさない

## Git Worktree

並列作業でworktreeを使う場合：

- プロジェクトディレクトリ内に作成する（`.worktree-<name>/`）
- プロジェクト外に作ると、サブエージェントの Read 権限が通らない
- `.gitignore` に `/.worktree-*/` を追加する

## 権限設定

バックグラウンドのサブエージェントはユーザーに権限プロンプトを出せない。

- `settings.local.json` の `permissions.allow` で必要なツールを事前に許可する
- Bash許可はコマンドのパターンマッチで動作する（例: `Bash(make test:*)` は `cd && make test` にマッチしない）
- 実用的にはサブエージェント並列実行時は `Bash` 全許可が必要
